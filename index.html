<!DOCTYPE html>
<html>

<head>
  <title>Mapa Interactivo</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- === Estilos de Leaflet y Leaflet.Draw === -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <style>
    /* === MAPA === */
    #map {
      height: 950px;
    }

    /* === MEN√ö SUPERIOR IZQUIERDO === */
    .menu {
      position: fixed;
      top: 1vh;
      left: 1vw;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.85);
      padding: 0.5em;
      border-radius: 5px;
      display: flex;
      flex-wrap: wrap;
    }

    button {
      margin: 3px;
      padding: 5px 5px;
      font-size: 10px;
    }

    /* === BOTONES DE DIBUJO (Leaflet.Draw) === */
    .leaflet-draw.leaflet-control {
      margin-top: 5vh !important;
    }

    /* === ESTILO DE LAS ETIQUETAS DE POL√çGONOS === */
    .etiqueta-poligono {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 100px;
      padding: 1px 5px;
      font-weight: 500;
      font-size: 15px;
      color: #060606;
      box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
      pointer-events: none;
      white-space: nowrap;
    }

    /* === MEN√ö CONTEXTUAL PERSONALIZADO === */
    .menu-contextual {
      background: white;
      padding: 8px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      font-size: 14px;
    }

    .menu-contextual button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      display: block;
      margin: 5px 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <!-- === MEN√ö DE BOTONES === -->
  <div class="menu">
    <button onclick="verTerritorios()">√Årea Grande</button>
    <button onclick="irATerritorio(1)">Territorio 1</button>
    <button onclick="irATerritorio(2)">Territorio 2</button>
    <button onclick="exportarPoligonos()">Exportar pol√≠gonos</button>
  </div>

  <!-- === MAPA === -->
  <div id="map"></div>

  <!-- === MEN√ö CONTEXTUAL (se llena din√°micamente) === -->
  <div id="menuContextual" class="menu-contextual" style="display:none; position:absolute; z-index:2000;"></div>

  <!-- === LIBRER√çAS EXTERNAS === -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

  <!-- === CONFIGURACI√ìN DEL MAPA BASE === -->
  <script>
    var map = L.map("map", { maxZoom: 22, zoomControl: false }).setView(
      [28.596, -106.0750],
      14
    );

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap",
      maxZoom: 22,
    }).addTo(map);

    var poligonos = [];

    // === OBJETO PARA GUARDAR NOTAS DE POL√çGONOS ===
    var notasPoligonos = {};

    function verTerritorios() {
      if (areaGrande) map.fitBounds(areaGrande.getBounds());
    }

    function irATerritorio(n) {
      if (poligonos[n - 1]) map.fitBounds(poligonos[n - 1].getBounds());
    }

    function exportarPoligonos() {
      alert("Funci√≥n de exportaci√≥n a√∫n no implementada.");
    }

    // === FUNCIONES DE NOTAS ===
    function anadirNota(id) {
      var nuevaNota = prompt("Escribe tu nota:");
      if (nuevaNota) {
        if (!notasPoligonos[id]) {
          notasPoligonos[id] = [];
        }
        notasPoligonos[id].push(nuevaNota);
        alert("‚úÖ Nota guardada!");
      }
      ocultarMenu();
    }

    function verNotas(id) {
      var listaNotas = notasPoligonos[id] || [];
      if (listaNotas.length === 0) {
        alert("üì≠ No hay notas todav√≠a.");
        ocultarMenu();
        return;
      }

      var notasTexto = listaNotas.map((n, i) => `${i + 1}. ${n}`).join("\n\n");
      var editar = confirm("üìí Notas:\n\n" + notasTexto + "\n\n¬øQuieres editar las notas?");

      if (editar) {
        var nuevasNotas = prompt("Edita las notas (separa por salto de l√≠nea):", listaNotas.join("\n"));
        if (nuevasNotas !== null) {
          notasPoligonos[id] = nuevasNotas.split("\n").filter(n => n.trim() !== "");
          alert("‚úèÔ∏è Notas actualizadas!");
        }
      }
      ocultarMenu();
    }

    // === FUNCIONES PARA MOSTRAR Y OCULTAR EL MEN√ö CONTEXTUAL ===
    function mostrarMenu(latlng, id, lat, lng) {
      var menu = document.getElementById("menuContextual");
      menu.style.left = event.pageX + "px";
      menu.style.top = event.pageY + "px";
      menu.style.display = "block";

      // Se genera el contenido din√°micamente
      menu.innerHTML = `
        <button onclick="window.open('https://www.google.com/maps?q=${lat},${lng}', '_blank'); ocultarMenu();">üìç Ubicaci√≥n</button>
        <button onclick="anadirNota('${id}')">‚ûï A√±adir nota</button>
        <button onclick="verNotas('${id}')">üìí Notas</button>
      `;
    }

    function ocultarMenu() {
      var menu = document.getElementById("menuContextual");
      menu.style.display = "none";
    }

    // Ocultar el men√∫ si se da click en cualquier otra parte
    map.on("click", ocultarMenu);
  </script>

  <!-- === ARCHIVOS EXTERNOS === -->
  <script src="area_grande.js"></script>
  <script src="territorio1.js"></script>
  <script src="territorio2.js"></script>
  <script src="dibujo.js"></script>
</body>

</html>