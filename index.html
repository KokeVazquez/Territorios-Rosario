<!DOCTYPE html>
<html>

<head>
  <title>Mapa Interactivo</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <style>
    #map {
      height: 100vh;
      /* ocupa todo el alto visible */
      width: 100vw;
      /* ocupa todo el ancho */
    }

    .menu {
      position: fixed;
      top: 1vh;
      left: 1vw;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.0);
      padding: 0.5em;
      border-radius: px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }


    #selectorTerritorios {
      padding: 1.2vh 1vw;
      /* adaptable según pantalla */
      font-size: 0.8vw;
      /* relativo al ancho de pantalla */
      font-weight: bold;
      border: 2px solid #000;
      /* borde negro elegante */
      outline: none;
      border-radius: 20px;
      /* píldora redondeada */
      background-color: #fff;
      /* blanco */
      color: #000;
      /* texto negro */
      cursor: pointer;
      /* quita estilos nativos del select */
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      /* flecha personalizada negra */
      background-image: url("data:image/svg+xml;utf8,<svg fill='black' height='24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
      background-repeat: no-repeat;
      background-position: right 1vw center;
      background-size: 16px;
      padding-right: 3vw;
      /* espacio para la flecha */
      /* animación suave */
      transition: all 0.25s ease-in-out;
    }

    /* efecto hover */
    #selectorTerritorios:hover {
      background-color: #ffffff;
      /* fondo negro */
      color: #000000;
      /* texto blanco */
      border-color: #444;
      /* borde gris oscuro */
      transform: scale(1.03);
      /* ligero “pop” */
    }

    /* efecto click/tap */
    #selectorTerritorios:active {
      transform: scale(0.97);
      /* encoge un poco al presionar */
      background-color: #222;
      /* fondo negro más suave */
      color: #fff;
      border-color: #111;
    }

    /* adaptación a pantallas pequeñas */
    @media (max-width: 480px) {
      #selectorTerritorios {
        font-size: 3vw;
        padding: 1.5vh 2vw;
        background-position: right 3vw center;
        padding-right: 6vw;
      }
    }




    .leaflet-draw.leaflet-control {
      margin-top: 5vh !important;
    }

    .etiqueta-poligono {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 100px;
      padding: 1px 5px;
      font-weight: 500;
      font-size: 15px;
      color: black;
      text-align: center;
      box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
      pointer-events: none;
      white-space: nowrap;
    }

    .menu-contextual {
      background: white;
      padding: 8px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      font-size: 14px;
    }

    .menu-contextual button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
      display: block;
      margin: 5px 0;
      width: 100%;
    }

    .etiquetaTerritorio {
      background: none;
      border-radius: 50%;
      padding: 5px 1px;
      font-weight: bold;
      font-size: 20px;
      color: black;
      text-align: center;
      pointer-events: none;
      box-shadow: 0 0px 0px black;
    }
  </style>
  <style>
    .boton-exportar {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1000;
      padding: 8px 12px;
      background: white;
      border: 1px solid gray;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>


<!--
===================================================================================================================================
                                                                  TERRITORIOS
===================================================================================================================================
-->

<body>
  <div class="menu">
    <select id="selectorTerritorios" onchange="cambiarTerritorio(); setTimeout(() => this.blur(), 200);">
      <option value="">-- Selecciona un territorio --</option>
      <option value="areaGrande">Área Grande</option>
      <option value="territorio1">Territorio 1</option>
      <option value="territorio2">Territorio 2</option>
      <option value="territorio3">Territorio 3</option>
      <option value="territorio4">Territorio 4</option>
      <option value="territorio5">Territorio 5</option>
      <option value="territorio6">Territorio 6</option>
      <option value="territorio7">Territorio 7</option>
      <option value="territorio8">Territorio 8</option>
      <option value="territorio9">Territorio 9</option>
      <option value="territorio10">Territorio 10</option>
      <option value="territorio11">Territorio 11</option>
      <option value="territorio12">Territorio 12</option>
      <option value="territorio13">Territorio 13</option>
      <option value="territorio14">Territorio 14</option>
      <option value="territorio15">Territorio 15</option>
      <option value="territorio16">Territorio 16</option>
      <option value="territorio17">Territorio 17</option>
      <option value="territorio18">Territorio 18</option>
      <option value="territorio19">Territorio 19</option>
      <option value="territorio20">Territorio 20</option>
      <option value="territorio21">Territorio 21</option>
      <option value="territorio22">Territorio 22</option>
      <option value="territorio23">Territorio 23</option>
      <option value="territorio24">Territorio 24</option>
      <option value="territorio25">Territorio 25</option>
      <option value="territorio26">Territorio 26</option>
      <option value="territorio27">Territorio 27</option>
      <option value="territorio28">Territorio 28</option>
      <option value="territorio29">Territorio 29</option>
      <option value="territorio30">Territorio 30</option>
      <option value="territorio31">Territorio 31</option>
      <option value="territorio32">Territorio 32</option>
      <option value="territorio33">Territorio 33</option>
      <option value="territorio34">Territorio 34</option>
      <option value="territorio35">Territorio 35</option>
      <option value="territorio36">Territorio 36</option>
      <option value="territorio37">Territorio 37</option>
      <option value="territorio38">Territorio 38</option>
      <option value="territorio39">Territorio 39</option>
      <option value="territorio40">Territorio 40</option>
      <option value="territorio41">Territorio 41</option>
      <option value="territorio42">Territorio 42</option>
      <option value="territorio43">Territorio 43</option>
      <option value="territorio44">Territorio 44</option>
      <option value="territorio45">Territorio 45</option>
      <option value="territorio46">Territorio 46</option>
      <option value="territorio47">Territorio 47</option>
      <option value="territorio48">Territorio 48</option>
      <option value="territorio49">Territorio 49</option>
      <option value="territorio50">Territorio 50</option>
      <option value="territorio51">Territorio 51</option>
      <option value="territorio52">Territorio 52</option>
      <option value="territorio53">Territorio 53</option>
      <option value="territorio54">Territorio 54</option>
      <option value="territorio55">Territorio 55</option>
      <option value="territorio56">Territorio 56</option>
      <option value="territorio57">Territorio 57</option>
      <option value="territorio58">Territorio 58</option>
      <option value="territorio59">Territorio 59</option>
      <option value="territorio60">Territorio 60</option>
      <option value="territorio61">Territorio 61</option>
      <option value="territorio62">Territorio 62</option>
      <option value="territorio63">Territorio 63</option>
      <option value="territorio64">Territorio 64</option>
      <option value="territorio65">Territorio 65</option>
      <option value="territorio66">Territorio 66</option>
      <option value="territorio67">Territorio 67</option>
      <option value="territorio68">Territorio 68</option>
      <option value="territorio69">Territorio 69</option>
      <option value="territorio70">Territorio 70</option>
      <option value="territorio71">Territorio 71</option>
      <option value="territorio72">Territorio 72</option>
      <option value="territorio73">Territorio 73</option>
      <option value="territorio74">Territorio 74</option>
      <option value="territorio75">Territorio 75</option>
      <option value="territorio76">Territorio 76</option>
      <option value="territorio77">Territorio 77</option>
      <option value="territorio78">Territorio 78</option>
      <option value="territorio79">Territorio 79</option>
      <option value="territorio80">Territorio 80</option>
      <option value="territorio81">Territorio 81</option>
      <option value="territorio82">Territorio 82</option>
      <option value="territorio83">Territorio 83</option>
      <option value="territorio84">Territorio 84</option>

    </select>
  </div>
  <!--
===================================================================================================================================
                                                                  FIN TERRITORIOS
===================================================================================================================================
-->

  <button onclick="exportarPoligonos()" style="position: absolute; top: 20px; right: 20px; z-index: 1000;">
    📤 Exportar
  </button>


  <div id="map"></div>
  <div id="menuContextual" class="menu-contextual" style="display:none; position:absolute; z-index:2000;"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

  <script>
    var map = L.map("map", { maxZoom: 22, zoomControl: false }).setView([28.608, -106.0680], 15);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "© OpenStreetMap", maxZoom: 22 }).addTo(map);

    var etiquetasActivas = [];

    // Array global de todos los marcadores fijos de territorios
    window.marcadoresIniciales = [];

    // ===============================
    // Funciones notas / menú
    // ===============================
    function anadirNota(id) { /* tu lógica existente */ }
    function verNotas(id) { /* tu lógica existente */ }
    function mostrarMenu(e, id, lat, lng) { /* tu lógica existente */ }
    function ocultarMenu() { document.getElementById("menuContextual").style.display = "none"; }
    map.on("click", ocultarMenu);

    // ===============================
    // Mostrar etiquetas de polígonos
    // ===============================
    function mostrarEtiquetas(territorio) {
      // Borrar etiquetas dinámicas previas
      etiquetasActivas.forEach(m => map.removeLayer(m));
      etiquetasActivas = [];

      territorio.eachLayer(function (pol) {
        if (pol._label) {
          let latlngs = pol.getLatLngs()[0];
          let coords = latlngs.map(ll => [ll.lng, ll.lat]);
          coords.push([coords[0][0], coords[0][1]]);
          let centroide = turf.centroid(turf.polygon([coords]));
          let cLat = centroide.geometry.coordinates[1];
          let cLng = centroide.geometry.coordinates[0];
          let marker = L.marker([cLat, cLng], {
            icon: L.divIcon({ className: "etiqueta-poligono", html: pol._label, iconSize: [10, 18], iconAnchor: [20, 9] })
          }).addTo(map);
          etiquetasActivas.push(marker);
        }
      });
    }

    // ===============================
    // Cambiar territorio desde select
    // ===============================
    function cambiarTerritorio() {
      var selector = document.getElementById("selectorTerritorios");
      var valor = selector.value;
      selector.blur();

      // Borrar etiquetas dinámicas previas
      etiquetasActivas.forEach(m => map.removeLayer(m));
      etiquetasActivas = [];

      // Ajustar zoom y mostrar etiquetas
      if (valor === "areaGrande") {
        if (typeof areaGrande !== "undefined" && areaGrande) map.fitBounds(areaGrande.getBounds());
      } else {
        // Para territorios 1 a 84
        const match = valor.match(/^territorio(\d+)$/);
        if (match) {
          const num = match[1];
          const grupo = window[`territorio${num}`];
          if (typeof grupo !== "undefined" && grupo) {
            map.fitBounds(grupo.getBounds());
            mostrarEtiquetas(grupo);
          }
        }
      }
    }

    // ===============================
    // Mostrar siempre los marcadores fijos
    // ===============================
    function registrarMarcadorFijo(marker) {
      if (!window.marcadoresIniciales.includes(marker)) {
        marker.addTo(map);
        window.marcadoresIniciales.push(marker);
      }
    }

  </script>

  <!-- Archivos externos de territorios -->

  <script src="dibujo.js"></script>

  <script src="area_grande.js"></script>
  <script src="territoriobase.js"></script>
  <script src="territorio1.js"></script>
  <script src="territorio2.js"></script>
  <script src="territorio3.js"></script>
  <script src="territorio4.js"></script>
  <script src="territorio5.js"></script>
  <script src="territorio6.js"></script>
  <script src="territorio7.js"></script>
  <script src="territorio8.js"></script>
  <script src="territorio9.js"></script>
  <script src="territorio10.js"></script>
  <script src="territorio11.js"></script>
  <script src="territorio12.js"></script>
  <script src="territorio13.js"></script>
  <script src="territorio14.js"></script>
  <script src="territorio15.js"></script>
  <script src="territorio16.js"></script>
  <script src="territorio17.js"></script>
  <script src="territorio18.js"></script>
  <script src="territorio19.js"></script>
  <script src="territorio20.js"></script>
  <script src="territorio21.js"></script>
  <script src="territorio22.js"></script>
  <script src="territorio23.js"></script>
  <script src="territorio24.js"></script>
  <script src="territorio25.js"></script>
  <script src="territorio26.js"></script>
  <script src="territorio27.js"></script>
  <script src="territorio28.js"></script>
  <script src="territorio29.js"></script>
  <script src="territorio30.js"></script>
  <script src="territorio31.js"></script>
  <script src="territorio32.js"></script>
  <script src="territorio33.js"></script>
  <script src="territorio34.js"></script>
  <script src="territorio35.js"></script>
  <script src="territorio36.js"></script>
  <script src="territorio37.js"></script>
  <script src="territorio38.js"></script>
  <script src="territorio39.js"></script>
  <script src="territorio40.js"></script>
  <script src="territorio41.js"></script>
  <script src="territorio42.js"></script>
  <script src="territorio43.js"></script>
  <script src="territorio44.js"></script>
  <script src="territorio45.js"></script>
  <script src="territorio46.js"></script>
  <script src="territorio47.js"></script>
  <script src="territorio48.js"></script>
  <script src="territorio49.js"></script>
  <script src="territorio50.js"></script>
  <script src="territorio51.js"></script>
  <script src="territorio52.js"></script>
  <script src="territorio53.js"></script>
  <script src="territorio54.js"></script>
  <script src="territorio55.js"></script>
  <script src="territorio56.js"></script>
  <script src="territorio57.js"></script>
  <script src="territorio58.js"></script>
  <script src="territorio59.js"></script>
  <script src="territorio60.js"></script>
  <script src="territorio61.js"></script>
  <script src="territorio62.js"></script>
  <script src="territorio63.js"></script>
  <script src="territorio64.js"></script>
  <script src="territorio65.js"></script>
  <script src="territorio66.js"></script>
  <script src="territorio67.js"></script>
  <script src="territorio68.js"></script>
  <script src="territorio69.js"></script>
  <script src="territorio70.js"></script>
  <script src="territorio71.js"></script>
  <script src="territorio72.js"></script>
  <script src="territorio73.js"></script>
  <script src="territorio74.js"></script>
  <script src="territorio75.js"></script>
  <script src="territorio76.js"></script>
  <script src="territorio77.js"></script>
  <script src="territorio78.js"></script>
  <script src="territorio79.js"></script>
  <script src="territorio80.js"></script>
  <script src="territorio81.js"></script>
  <script src="territorio82.js"></script>
  <script src="territorio83.js"></script>
  <script src="territorio84.js"></script>

</body>

</html>